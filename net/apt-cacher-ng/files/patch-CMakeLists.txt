--- CMakeLists.txt.orig	2016-02-13 08:52:49 UTC
+++ CMakeLists.txt
@@ -77,7 +77,7 @@ TEST_BIG_ENDIAN(WORDS_BIGENDIAN)
 # also influence it, need to be adjusted carefully by user.
 SET(ACNG_CXXFLAGS_COMMON "-D_FILE_OFFSET_BITS=64")
 
-foreach(cxxarg  -pthread -Wall -Wextra -Wno-unused-parameter -fvisibility-inlines-hidden)
+foreach(cxxarg -Wall -Wextra -Wno-unused-parameter -fvisibility-inlines-hidden)
 	STRING(REGEX REPLACE "=|-|," "" optname "${cxxarg}")
   CHECK_CXX_COMPILER_FLAG("${cxxarg}" "CXX_${optname}")
   if(CXX_${optname})
@@ -85,7 +85,7 @@ foreach(cxxarg  -pthread -Wall -Wextra -
 	endif()
 endforeach()
 
-foreach(linkarg -Wl,--as-needed -Wl,-O1 -Wl,--discard-all -Wl,--no-undefined -Wl,--build-id=sha1)
+foreach(linkarg -lpthread -Wl,--as-needed -Wl,-O1 -Wl,--discard-all -Wl,--no-undefined -Wl,--build-id=sha1)
 	STRING(REGEX REPLACE "=|-|," "" optname "${linkarg}")
 	set(CMAKE_REQUIRED_FLAGS "${linkarg}")
 	CHECK_CXX_COMPILER_FLAG("" "LD_${optname}")
@@ -230,7 +230,6 @@ if(NOT HAVE_MEMORY_SPTR)
    message(FATAL_ERROR "Could not find a working smart pointer implementation.")
 endif()
 
-SET(CMAKE_REQUIRED_LIBRARIES dl)
 FILE(READ test/build/HAVE_DLOPEN.cc TESTSRC)
 CHECK_CXX_SOURCE_COMPILES("${TESTSRC}" HAVE_DLOPEN)
 
@@ -248,12 +247,12 @@ else(HAVE_ZLIB)
    message(FATAL_ERROR "!! apt-cacher-ng requires gzip library and development files ${HAVE_ZLIB}")
 endif(HAVE_ZLIB)
 
-INCLUDE(FindBZip2)
+find_package(BZip2)
 if (BZIP2_FOUND)
    SET(HAVE_LIBBZ2 1)
    MARK_AS_ADVANCED(HAVE_LIBBZ2)
 	INCLUDE_DIRECTORIES(${BZIP2_INCLUDE_DIR})
-	list(APPEND CompLibs bz2)
+	list(APPEND CompLibs ${BZIP2_LIBRARIES})
 else (BZIP2_FOUND)
    message("!! apt-cacher-ng requires bzip2 library and development files for bz2 format support")
 endif (BZIP2_FOUND)
@@ -273,11 +272,11 @@ SET(CMAKE_REQUIRED_LIBRARIES "")
 set(HAVE_CHECKSUM on)
 
 if(USE_SSL)
-	pkg_check_modules(openssl openssl)
-	if(openssl_FOUND)
+	find_package(OpenSSL)
+	if(OPENSSL_FOUND)
 		set(HAVE_SSL on)
-		string(REPLACE ";" " " ACNG_CXXFLAGS_COMMON "${ACNG_CXXFLAGS_COMMON} ${openssl_CFLAGS}")
-		string(REPLACE ";" " " SSL_LIB_LIST "${openssl_LDFLAGS}")
+		include_directories(${OPENSSL_INCLUDE_DIR})
+		list(APPEND SSL_LIB_LIST ${OPENSSL_LIBRARIES})
 	else()
 		message(WARNING "OpenSSL not found, disabling TLS connection support")
 		set(HAVE_SSL off)
@@ -344,7 +343,7 @@ if(NOT DEFINED(HTMLDIR))
 		set(HTMLDIR ${DOCDIR}/html)
 endif()
 if(NOT DEFINED(MANDIR))
-   set(MANDIR ${DATADIR}/man)
+   set(MANDIR ${CMAKE_INSTALL_PREFIX}/man)
 endif()
 install(FILES doc/README doc/apt-cacher-ng.pdf DESTINATION ${DOCDIR})
 install(DIRECTORY doc/html/ DESTINATION ${HTMLDIR}
