--- CMakeLists.txt.orig	2016-01-24 08:22:50 UTC
+++ CMakeLists.txt
@@ -230,7 +230,6 @@ if(NOT HAVE_MEMORY_SPTR)
    message(FATAL_ERROR "Could not find a working smart pointer implementation.")
 endif()
 
-SET(CMAKE_REQUIRED_LIBRARIES dl)
 FILE(READ test/build/HAVE_DLOPEN.cc TESTSRC)
 CHECK_CXX_SOURCE_COMPILES("${TESTSRC}" HAVE_DLOPEN)
 
@@ -248,7 +247,7 @@ else(HAVE_ZLIB)
    message(FATAL_ERROR "!! apt-cacher-ng requires gzip library and development files ${HAVE_ZLIB}")
 endif(HAVE_ZLIB)
 
-INCLUDE(FindBZip2)
+find_package(BZip2)
 if (BZIP2_FOUND)
    SET(HAVE_LIBBZ2 1)
    MARK_AS_ADVANCED(HAVE_LIBBZ2)
@@ -273,11 +272,11 @@ SET(CMAKE_REQUIRED_LIBRARIES "")
 set(HAVE_CHECKSUM on)
 
 if(USE_SSL)
-	pkg_check_modules(openssl openssl)
-	if(openssl_FOUND)
+	find_package(OpenSSL)
+	if(OPENSSL_FOUND)
 		set(HAVE_SSL on)
-		string(REPLACE ";" " " ACNG_CXXFLAGS_COMMON "${ACNG_CXXFLAGS_COMMON} ${openssl_CFLAGS}")
-		string(REPLACE ";" " " SSL_LIB_LIST "${openssl_LDFLAGS}")
+		include_directories(${OPENSSL_INCLUDE_DIR})
+		list(APPEND SSL_LIB_LIST ${OPENSSL_LIBRARIES})
 	else()
 		message(WARNING "OpenSSL not found, disabling TLS connection support")
 		set(HAVE_SSL off)
@@ -344,7 +343,7 @@ if(NOT DEFINED(HTMLDIR))
 		set(HTMLDIR ${DOCDIR}/html)
 endif()
 if(NOT DEFINED(MANDIR))
-   set(MANDIR ${DATADIR}/man)
+   set(MANDIR ${CMAKE_INSTALL_PREFIX}/man)
 endif()
 install(FILES doc/README doc/apt-cacher-ng.pdf DESTINATION ${DOCDIR})
 install(DIRECTORY doc/html/ DESTINATION ${HTMLDIR}
